{% extends "base.html" %}

{% block title %}Retrosynthesis Planner{% endblock %}
{% block page_title %}Retrosynthesis Planner<span id="status"></span>{% endblock %}

{% block extrahead %}{% endblock %}

{% block navbar_items %}
<a href="{% url 'main.views.retro_interactive' %}">Planner</a>
{% endblock %}

{% block sidebar_items %}{% endblock %}

{% block javascript %}
<script>
$("#id_smiles").change(function () {
	console.log( $(this).val() );
	$.ajax({
		url: '/ajax/smiles_to_image_retro/',
		data: {
			smiles: $(this).val(),
		},
		dataType: 'json',
		success: function (data) {
			$("#status").html('');
			$("#statistics").html('');
			$("#results").html('');
			$("#start_retro").html('Start');
			if (data.err) {
				$("#target_mol").html('error! could not parse');
				$("#target_mol_wrapper").show();
				$("#controls_wrapper").hide();
				$("#settings_wrapper").hide();
			} else {
				$("#target_mol").html(data.html);
				$("#target_mol_wrapper").show();
				$("#controls_wrapper").show();
				$("#settings_wrapper").show();
				$("#id_smiles").val(data.smiles);
			}
		},
	});

});
$("#start_retro").click(function () {
	console.log('starting retro');
	$.ajax({
		url: '/ajax/start_retro/',
		data: {
			smiles: $("#id_smiles").val(),
			max_depth: $("#max_depth").val(),
			max_branching: $("#max_branching").val(),
		},
		dataType: 'json',
		success: function (data) {
			if (data.err) {
				alert(data.message);
			} else {
				$("#status").html(': running...');
				$("#start_retro").html('Start');
			}
		}
	});
});
$("#pause_retro").click(function () {
	console.log('pausing retro');
	$.ajax({
		url: '/ajax/pause_retro/',
		data: {
			smiles: $("#id_smiles").val(),
		},
		dataType: 'json',
		success: function (data) {
			if (data.err) {
				alert(data.message);
			} else {
				$("#status").html(': paused');
				$("#start_retro").html('Resume')
			}
		}
	});
});
$("#stop_retro").click(function () {
	console.log('stopping retro');
	$.ajax({
		url: '/ajax/stop_retro/',
		data: {
			smiles: $("#id_smiles").val(),
		},
		dataType: 'json',
		success: function (data) {
			if (data.err) {
				alert(data.message);
			} else {
				$("#status").html(': stopped');
				$("#start_retro").html('Start');
			}
		}
	});
});
$("#update_retro_stats").click(function () {
	console.log('updating retro');
	$.ajax({
		url: '/ajax/update_retro_stats/',
		data: {
			smiles: $("#id_smiles").val(),
		},
		dataType: 'json',
		success: function (data) {
			if (data.err) {
				alert(data.message);
			} else {
				$("#statistics").html(data.html_stats);
			}
		}
	});
});
$("#update_retro").click(function () {
	console.log('updating retro');
	$.ajax({
		url: '/ajax/update_retro/',
		data: {
			smiles: $("#id_smiles").val(),
		},
		dataType: 'json',
		success: function (data) {
			if (data.err) {
				alert(data.message);
			} else {
				$("#statistics").html(data.html_stats);
				$("#results").html(data.html_trees);
			}
		}
	});
});
</script>
{% endblock %}


{% block page_body %}

<table>

<tr><th>Enter target compound:</th><td><input id="id_smiles" maxlength="500" size="40" type="text"/></td></tr>

<tr><th>{% csrf_token %}</th></tr>

<!-- Placeholder for rendering image after a SMILES string is entered -->
<tr id="target_mol_wrapper" style="display:none"><th style="vertical-align: text-top; text-align:left">Parsed structure:</th><td id="target_mol"></td></tr>

<!-- Settings -->
<tr id="settings_wrapper" style="display:none"><th style="vertical-align: bottom; text-align:left">Settings:</th>
<td>
	Max. depth (1-9): <input type="text" id="max_depth" pattern="[1-9]" size="1" maxlength="1" value="4">
	Max. branching factor: <input type="text" id="max_branching" pattern="[0-9]*" size="4" maxlength="4" value="20">
</td>
</tr>

<!-- Controls -->
<tr id="controls_wrapper" style="display:none"><th style="vertical-align: bottom; text-align:left">Controls:</th>
<td>
	<button type="button" style="width:100px" id="start_retro">Start</button>
	<button type="button" style="width:100px" id="pause_retro">Pause</button>
	<button type="button" style="width:100px" id="stop_retro">Stop</button>
	<button type="button" style="width:100px" id="update_retro_stats">Show stats</button>
	<button type="button" style="width:100px" id="update_retro">Show results</button>
</td>
</tr>

</table>

<!-- Results -->
<div id="statistics"></div>
<br/>
<div id="results"></div>

{% endblock %}
