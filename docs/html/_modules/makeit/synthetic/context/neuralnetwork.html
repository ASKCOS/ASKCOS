
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>makeit.synthetic.context.neuralnetwork &#8212; ASKCOS 0.3.0 documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for makeit.synthetic.context.neuralnetwork</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">makeit.global_config</span> <span class="k">as</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="k">import</span> <span class="n">model_from_json</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="k">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="kn">import</span> <span class="nn">makeit.utilities.fingerprinting</span> <span class="k">as</span> <span class="nn">fp</span>
<span class="kn">from</span> <span class="nn">makeit.utilities.io.logger</span> <span class="k">import</span> <span class="n">MyLogger</span>
<span class="kn">from</span> <span class="nn">makeit.interfaces.context_recommender</span> <span class="k">import</span> <span class="n">ContextRecommender</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="k">import</span> <span class="n">Chem</span>
<span class="n">contextRecommender_loc</span> <span class="o">=</span> <span class="s1">&#39;contextRecommender&#39;</span>


<div class="viewcode-block" id="NeuralNetContextRecommender"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender">[docs]</a><span class="k">class</span> <span class="nc">NeuralNetContextRecommender</span><span class="p">(</span><span class="n">ContextRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reaction condition predictor based on Neural Network method</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nnModel ():</span>
<span class="sd">        c1_dict ():</span>
<span class="sd">        s1_dict ():</span>
<span class="sd">        s2_dict ():</span>
<span class="sd">        r1_dict ():</span>
<span class="sd">        r2_dict ():</span>
<span class="sd">        num_cond ():</span>
<span class="sd">        singleSlvt ():</span>
<span class="sd">        with_smiles ():</span>
<span class="sd">        max_total_context ():</span>
<span class="sd">        max_context ():</span>
<span class="sd">        fp_size ():</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_contexts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">singleSlvt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_smiles</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes Neural Network predictor.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_contexts (int, optional): ?? (default: {10})</span>
<span class="sd">            singleSlvt (bool, optional): Whether to use only a single</span>
<span class="sd">                solvent. (default: {True})</span>
<span class="sd">            with_smiles (bool, optional): ?? (default: {True})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s1_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r1_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cond</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singleSlvt</span> <span class="o">=</span> <span class="n">singleSlvt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_smiles</span> <span class="o">=</span> <span class="n">with_smiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_total_context</span> <span class="o">=</span> <span class="n">max_contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_context</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span> <span class="o">=</span> <span class="mi">2048</span>

<div class="viewcode-block" id="NeuralNetContextRecommender.load"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="n">NEURALNET_CONTEXT_REC</span><span class="p">[</span><span class="s1">&#39;model_path&#39;</span><span class="p">],</span> <span class="n">info_path</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="n">NEURALNET_CONTEXT_REC</span><span class="p">[</span>
                       <span class="s1">&#39;info_path&#39;</span><span class="p">],</span> <span class="n">weights_path</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="n">NEURALNET_CONTEXT_REC</span><span class="p">[</span><span class="s1">&#39;weights_path&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Loads the specified model and weights.</span>

<span class="sd">        Wrapper function for load_nn_model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_path (str, optional): Path to file specifying model.</span>
<span class="sd">                (default: {gc.NEURALNET_CONTEXT_REC[&#39;model_path&#39;]})</span>
<span class="sd">            info_path (str, optional): Path to file specifying encoders.</span>
<span class="sd">                (default: {gc.NEURALNET_CONTEXT_REC[&#39;info_path&#39;]})</span>
<span class="sd">            weights_path (str, optional): Path to file specifying weights.</span>
<span class="sd">                (default: {gc.NEURALNET_CONTEXT_REC[&#39;weights_path&#39;]})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for the neural net model, info path points to the encoders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_nn_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">info_path</span><span class="p">,</span> <span class="n">weights_path</span><span class="p">)</span>

        <span class="n">MyLogger</span><span class="o">.</span><span class="n">print_and_log</span><span class="p">(</span>
            <span class="s1">&#39;Nerual network context recommender has been loaded.&#39;</span><span class="p">,</span> <span class="n">contextRecommender_loc</span><span class="p">)</span></div>

<div class="viewcode-block" id="NeuralNetContextRecommender.load_nn_model"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.load_nn_model">[docs]</a>    <span class="k">def</span> <span class="nf">load_nn_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">info_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">weights_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads specified Neural Network model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_path (str, optional): Path to file specifying model.</span>
<span class="sd">                (default: {&#39;&#39;})</span>
<span class="sd">            info_path (str, optional): Path to file specifying encoders.</span>
<span class="sd">                (default: {&#39;&#39;})</span>
<span class="sd">            weights_path (str, optional): Path to file specifying weights.</span>
<span class="sd">                (default: {&#39;&#39;})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_path</span><span class="p">:</span>
            <span class="n">MyLogger</span><span class="o">.</span><span class="n">print_and_log</span><span class="p">(</span>
                <span class="s1">&#39;Cannot load neural net context recommender without a specific path to the model. Exiting...&#39;</span><span class="p">,</span> <span class="n">contextRecommender_loc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">info_path</span><span class="p">:</span>
            <span class="n">MyLogger</span><span class="o">.</span><span class="n">print_and_log</span><span class="p">(</span>
                <span class="s1">&#39;Cannot load nerual net context recommender without a specific path to the model info. Exiting...&#39;</span><span class="p">,</span> <span class="n">contextRecommender_loc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1">###load model##############</span>
        <span class="c1"># load json and create model</span>
        <span class="n">K</span><span class="o">.</span><span class="n">set_learning_phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">json_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">loaded_model_json</span> <span class="o">=</span> <span class="n">json_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">json_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span> <span class="o">=</span> <span class="n">model_from_json</span><span class="p">(</span><span class="n">loaded_model_json</span><span class="p">)</span>
        <span class="c1"># load weights into new model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">load_weights</span><span class="p">(</span><span class="n">weights_path</span><span class="p">)</span>
        <span class="c1"># get fp_size based on the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">r1_dict_file</span> <span class="o">=</span> <span class="n">info_path</span> <span class="o">+</span> <span class="s2">&quot;r1_dict.pickle&quot;</span>
        <span class="n">r2_dict_file</span> <span class="o">=</span> <span class="n">info_path</span> <span class="o">+</span> <span class="s2">&quot;r2_dict.pickle&quot;</span>
        <span class="n">s1_dict_file</span> <span class="o">=</span> <span class="n">info_path</span> <span class="o">+</span> <span class="s2">&quot;s1_dict.pickle&quot;</span>
        <span class="n">s2_dict_file</span> <span class="o">=</span> <span class="n">info_path</span> <span class="o">+</span> <span class="s2">&quot;s2_dict.pickle&quot;</span>
        <span class="n">c1_dict_file</span> <span class="o">=</span> <span class="n">info_path</span> <span class="o">+</span> <span class="s2">&quot;c1_dict.pickle&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">r1_dict_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">R1_DICT_F</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r1_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">R1_DICT_F</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">r2_dict_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">R2_DICT_F</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r2_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">R2_DICT_F</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">s1_dict_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">S1_DICT_F</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s1_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">S1_DICT_F</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">s2_dict_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">S2_DICT_F</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s2_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">S2_DICT_F</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">c1_dict_file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">C1_DICT_F</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c1_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">C1_DICT_F</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c1_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r1_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s1_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">input_shape</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">fp_transform_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;fp_transform1&#39;</span><span class="p">)</span>
        <span class="n">c1_input_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;input_c1&#39;</span><span class="p">)</span>
        <span class="n">s1_input_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;input_s1&#39;</span><span class="p">)</span>
        <span class="n">s2_input_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;input_s2&#39;</span><span class="p">)</span>
        <span class="n">r1_input_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;input_r1&#39;</span><span class="p">)</span>
        <span class="n">r2_input_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;input_r2&#39;</span><span class="p">)</span>
        <span class="n">c1_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>
        <span class="n">s1_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;s1&#39;</span><span class="p">)</span>
        <span class="n">s2_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;s2&#39;</span><span class="p">)</span>
        <span class="n">r1_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;r1&#39;</span><span class="p">)</span>
        <span class="n">r2_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
        <span class="n">T_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fp_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nnModel</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="p">[</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">],</span> <span class="p">[</span><span class="n">c1_output</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s1_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">c1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">],</span> <span class="p">[</span><span class="n">s1_output</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">c1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">s1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">],</span> <span class="p">[</span><span class="n">s2_output</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r1_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">c1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">s1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">s2_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">],</span> <span class="p">[</span><span class="n">r1_output</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r2_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">c1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">s1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">s2_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">r1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">],</span> <span class="p">[</span><span class="n">r2_output</span><span class="o">.</span><span class="n">output</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_func</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">function</span><span class="p">([</span><span class="n">fp_transform_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">c1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">s1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">s2_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">r1_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">,</span><span class="n">r2_input_layer</span><span class="o">.</span><span class="n">output</span><span class="p">],</span> <span class="p">[</span><span class="n">T_output</span><span class="o">.</span><span class="n">output</span><span class="p">])</span></div>

<div class="viewcode-block" id="NeuralNetContextRecommender.load_predictor"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.load_predictor">[docs]</a>    <span class="k">def</span> <span class="nf">load_predictor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userInput</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads the predictor based on user input.</span>

<span class="sd">        Args:</span>
<span class="sd">            userInput (dict): Specifies values to use for the main attributes of</span>
<span class="sd">                the predictor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cond</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;num_cond&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_limit</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;dist_limit&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singleSlvt</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;first_solvent_only&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_smiles</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;with_smiles_only&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_total_context</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;max_total_context&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_int</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;max_int&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_context</span> <span class="o">=</span> <span class="n">userInput</span><span class="p">[</span><span class="s1">&#39;max_context&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="NeuralNetContextRecommender.get_n_conditions"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.get_n_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">get_n_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rxn</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">singleSlvt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_smiles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_scores</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the top n parseable reaction condition recommendations.</span>

<span class="sd">        Reaction condition recommendations for a rxn (SMILES) from top n NN</span>

<span class="sd">        Args:</span>
<span class="sd">            rxn (str): SMILES string for reaction.</span>
<span class="sd">            n (int, optional): Number of condition recomendations to return.</span>
<span class="sd">                (default: {10})</span>
<span class="sd">            singleSlvt (bool, optional): Whether to use a single solvent.</span>
<span class="sd">                (default: {true})</span>
<span class="sd">            with_smiles (bool, optional): ?? (default: {True})</span>
<span class="sd">            return_scores (bool, optional): Whether to also return the scores of the</span>
<span class="sd">                recomendations. (default: {True})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print(&#39;started neuralnet&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singleSlvt</span> <span class="o">=</span> <span class="n">singleSlvt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_smiles</span> <span class="o">=</span> <span class="n">with_smiles</span>
        <span class="c1"># print(&#39;rxn to recommend context for : {}&#39;.format(rxn), contextRecommender_loc)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rsmi</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">psmi</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">rct_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">rsmi</span><span class="p">)</span>
            <span class="n">prd_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">psmi</span><span class="p">)</span>
            <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">ClearProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)</span> <span class="k">for</span> \
                    <span class="n">atom</span> <span class="ow">in</span> <span class="n">rct_mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">ClearProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)</span> <span class="k">for</span> \
                    <span class="n">atom</span> <span class="ow">in</span> <span class="n">prd_mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)]</span>
            <span class="n">rsmi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">rct_mol</span><span class="p">,</span> <span class="n">isomericSmiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">psmi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">prd_mol</span><span class="p">,</span> <span class="n">isomericSmiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">[</span><span class="n">pfp</span><span class="p">,</span> <span class="n">rfp</span><span class="p">]</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">create_rxn_Morgan2FP_separately</span><span class="p">(</span>
                <span class="n">rsmi</span><span class="p">,</span> <span class="n">psmi</span><span class="p">,</span> <span class="n">rxnfpsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">,</span> <span class="n">pfpsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">,</span> <span class="n">useFeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calculate_rfp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useChirality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">pfp</span> <span class="o">=</span> <span class="n">pfp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">)</span>
            <span class="n">rfp</span> <span class="o">=</span> <span class="n">rfp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">)</span>
            <span class="n">rxnfp</span> <span class="o">=</span> <span class="n">pfp</span> <span class="o">-</span> <span class="n">rfp</span>
            <span class="n">c1_input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">r1_input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">r2_input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">s1_input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">s2_input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfp</span><span class="p">,</span> <span class="n">rxnfp</span><span class="p">,</span> <span class="n">c1_input</span><span class="p">,</span> <span class="n">r1_input</span><span class="p">,</span>
                      <span class="n">r2_input</span><span class="p">,</span> <span class="n">s1_input</span><span class="p">,</span> <span class="n">s2_input</span><span class="p">]</span>

            <span class="p">(</span><span class="n">top_combos</span><span class="p">,</span><span class="n">top_combo_scores</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_top_combos</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">return_scores</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">top_combos</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span><span class="n">top_combo_scores</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">top_combos</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="c1"># MyLogger.print_and_log(&#39;Failed for reaction {} because {}. Returning None.&#39;.format(</span>
            <span class="c1">#     rxn, e), contextRecommender_loc, level=2)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed for reaction </span><span class="si">{}</span><span class="s1"> because </span><span class="si">{}</span><span class="s1">. Returning None.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">rxn</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">contextRecommender_loc</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[[]]</span></div>

<div class="viewcode-block" id="NeuralNetContextRecommender.path_condition"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.path_condition">[docs]</a>    <span class="k">def</span> <span class="nf">path_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recommends reaction conditions reaction path with multiple reactions.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): Number of options to use at each step.</span>
<span class="sd">            path (list): Reaction SMILES for each step.</span>


<span class="sd">            Returns:</span>
<span class="sd">                A list of reaction contexts with n options for each step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rsmi_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">psmi_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">contexts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rsmi</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">psmi</span> <span class="o">=</span> <span class="n">rxn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">rct_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">rsmi</span><span class="p">)</span>
                <span class="n">prd_mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">psmi</span><span class="p">)</span>
                <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">ClearProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)</span><span class="k">for</span> \
                        <span class="n">atom</span> <span class="ow">in</span> <span class="n">rct_mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)]</span>
                <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">ClearProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)</span><span class="k">for</span> \
                        <span class="n">atom</span> <span class="ow">in</span> <span class="n">prd_mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">HasProp</span><span class="p">(</span><span class="s1">&#39;molAtomMapNumber&#39;</span><span class="p">)]</span>
                <span class="n">rsmi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">rct_mol</span><span class="p">,</span> <span class="n">isomericSmiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">psmi</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">prd_mol</span><span class="p">,</span> <span class="n">isomericSmiles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">[</span><span class="n">pfp</span><span class="p">,</span> <span class="n">rfp</span><span class="p">]</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">create_rxn_Morgan2FP_separately</span><span class="p">(</span>
                    <span class="n">rsmi</span><span class="p">,</span> <span class="n">psmi</span><span class="p">,</span> <span class="n">rxnfpsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">,</span> <span class="n">pfpsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">,</span> <span class="n">useFeatures</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">calculate_rfp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useChirality</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">pfp</span> <span class="o">=</span> <span class="n">pfp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">)</span>
                <span class="n">rfp</span> <span class="o">=</span> <span class="n">rfp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp_size</span><span class="p">)</span>
                <span class="n">rxnfp</span> <span class="o">=</span> <span class="n">pfp</span> <span class="o">-</span> <span class="n">rfp</span>
                <span class="n">c1_input</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">r1_input</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">r2_input</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">s1_input</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">s2_input</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfp</span><span class="p">,</span> <span class="n">rxnfp</span><span class="p">,</span> <span class="n">c1_input</span><span class="p">,</span> <span class="n">r1_input</span><span class="p">,</span>
                          <span class="n">r2_input</span><span class="p">,</span> <span class="n">s1_input</span><span class="p">,</span> <span class="n">s2_input</span><span class="p">]</span>
                <span class="n">top_combos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_top_combos</span><span class="p">(</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">c1_rank_thres</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s1_rank_thres</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s2_rank_thres</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">r1_rank_thres</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">r2_rank_thres</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top_combos</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">MyLogger</span><span class="o">.</span><span class="n">print_and_log</span><span class="p">(</span><span class="s1">&#39;Failed for reaction </span><span class="si">{}</span><span class="s1"> because </span><span class="si">{}</span><span class="s1">. Returning None.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">rxn</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">contextRecommender_loc</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contexts</span></div>

<div class="viewcode-block" id="NeuralNetContextRecommender.predict_top_combos"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.predict_top_combos">[docs]</a>    <span class="k">def</span> <span class="nf">predict_top_combos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">return_categories_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                           <span class="n">c1_rank_thres</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s1_rank_thres</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s2_rank_thres</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">r1_rank_thres</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">r2_rank_thres</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Predicts top combos based on rank thresholds for individual elements.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputs (list??): Input values for model.</span>
<span class="sd">            return_categories_only (bool, optional): Whether to only return the</span>
<span class="sd">                categories. Used for testing. (default: {False})</span>
<span class="sd">            c1_rank_thres (int, optional): Rank threshold for c1??</span>
<span class="sd">                (default: {2})</span>
<span class="sd">            s1_rank_thres (int, optional): Rank threshold for s1??</span>
<span class="sd">                (default: {3})</span>
<span class="sd">            s2_rank_thres (int, optional): Rank threshold for s2??</span>
<span class="sd">                (default: {1})</span>
<span class="sd">            r1_rank_thres (int, optional): Rank threshold for r1??</span>
<span class="sd">                (default: {3})</span>
<span class="sd">            r2_rank_thres (int, optional): Rank threshold for r2??</span>
<span class="sd">                (default: {1})</span>

<span class="sd">        Returns:</span>
<span class="sd">            2-tuple of lists: Context combinations and scores predicted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this function predicts the top combos based on rank thresholds for</span>
        <span class="c1"># individual elements</span>
        <span class="n">context_combos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">context_combo_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num_combos</span> <span class="o">=</span> <span class="n">c1_rank_thres</span><span class="o">*</span><span class="n">s1_rank_thres</span> <span class="o">*</span> \
            <span class="n">s2_rank_thres</span><span class="o">*</span><span class="n">r1_rank_thres</span><span class="o">*</span><span class="n">r2_rank_thres</span>
        <span class="p">[</span><span class="n">pfp</span><span class="p">,</span> <span class="n">rxnfp</span><span class="p">,</span> <span class="n">c1_input_user</span><span class="p">,</span> <span class="n">r1_input_user</span><span class="p">,</span>
            <span class="n">r2_input_user</span><span class="p">,</span> <span class="n">s1_input_user</span><span class="p">,</span> <span class="n">s2_input_user</span><span class="p">]</span> <span class="o">=</span> <span class="n">inputs</span>

        <span class="c1"># set s2 to be none ## specifically for the single sovlent case</span>
        <span class="c1"># s2_input_user = np.zeros(s2_dim,dtype = &#39;float32&#39;).reshape(1,s2_dim)</span>
        <span class="c1"># s2_input_user[0] = 1</span>
        <span class="n">c1_input_dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1_dim</span><span class="p">)</span>
        <span class="n">r1_input_dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r1_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r1_dim</span><span class="p">)</span>
        <span class="n">r2_input_dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r2_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_dim</span><span class="p">)</span>
        <span class="n">s1_input_dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s1_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1_dim</span><span class="p">)</span>
        <span class="n">s2_input_dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2_dim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2_dim</span><span class="p">)</span>
        <span class="n">model_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfp</span><span class="p">,</span> <span class="n">rxnfp</span><span class="p">,</span> <span class="n">c1_input_dum</span><span class="p">,</span> <span class="n">r1_input_dum</span><span class="p">,</span>
                            <span class="n">r2_input_dum</span><span class="p">,</span> <span class="n">s1_input_dum</span><span class="p">,</span> <span class="n">s2_input_dum</span><span class="p">]</span>
        <span class="n">fp_trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp_func</span><span class="p">(</span><span class="n">model_inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c1_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">c1_inputs</span> <span class="o">=</span> <span class="n">fp_trans</span>
            <span class="n">c1_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1_func</span><span class="p">(</span><span class="n">c1_inputs</span><span class="p">)</span>
            <span class="n">c1_cdts</span> <span class="o">=</span> <span class="n">c1_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="n">c1_rank_thres</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c1_cdts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">c1_input_user</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># find the name of catalyst</span>
        <span class="k">for</span> <span class="n">c1_cdt</span> <span class="ow">in</span> <span class="n">c1_cdts</span><span class="p">:</span>
            <span class="n">c1_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1_dict</span><span class="p">[</span><span class="n">c1_cdt</span><span class="p">]</span>
            <span class="n">c1_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1_dim</span><span class="p">])</span>
            <span class="n">c1_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">c1_cdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">c1_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">c1_sc</span> <span class="o">=</span> <span class="n">c1_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">c1_cdt</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c1_sc</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">s1_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">s1_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c1_input</span><span class="p">]</span>
                <span class="n">s1_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1_func</span><span class="p">(</span><span class="n">s1_inputs</span><span class="p">)</span>
                <span class="n">s1_cdts</span> <span class="o">=</span> <span class="n">s1_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="n">s1_rank_thres</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s1_cdts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">s1_input_user</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">s1_cdt</span> <span class="ow">in</span> <span class="n">s1_cdts</span><span class="p">:</span>
                <span class="n">s1_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1_dict</span><span class="p">[</span><span class="n">s1_cdt</span><span class="p">]</span>
                <span class="n">s1_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1_dim</span><span class="p">])</span>
                <span class="n">s1_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">s1_cdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">s1_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">s1_sc</span> <span class="o">=</span> <span class="n">s1_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">s1_cdt</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s1_sc</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">s2_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">s2_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c1_input</span><span class="p">,</span> <span class="n">s1_input</span><span class="p">]</span>
                    <span class="n">s2_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2_func</span><span class="p">(</span><span class="n">s2_inputs</span><span class="p">)</span>
                    <span class="n">s2_cdts</span> <span class="o">=</span> <span class="n">s2_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="n">s2_rank_thres</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s2_cdts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">s2_input_user</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">s2_cdt</span> <span class="ow">in</span> <span class="n">s2_cdts</span><span class="p">:</span>
                    <span class="n">s2_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2_dict</span><span class="p">[</span><span class="n">s2_cdt</span><span class="p">]</span>
                    <span class="n">s2_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2_dim</span><span class="p">])</span>
                    <span class="n">s2_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">s2_cdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">s2_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">s2_sc</span> <span class="o">=</span> <span class="n">s2_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">s2_cdt</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">s2_sc</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">r1_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">r1_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c1_input</span><span class="p">,</span> <span class="n">s1_input</span><span class="p">,</span> <span class="n">s2_input</span><span class="p">]</span>
                        <span class="n">r1_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r1_func</span><span class="p">(</span><span class="n">r1_inputs</span><span class="p">)</span>
                        <span class="n">r1_cdts</span> <span class="o">=</span> <span class="n">r1_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span>
                            <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="n">r1_rank_thres</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">r1_cdts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r1_input_user</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">r1_cdt</span> <span class="ow">in</span> <span class="n">r1_cdts</span><span class="p">:</span>
                        <span class="n">r1_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r1_dict</span><span class="p">[</span><span class="n">r1_cdt</span><span class="p">]</span>
                        <span class="n">r1_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r1_dim</span><span class="p">])</span>
                        <span class="n">r1_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">r1_cdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">r1_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                            <span class="n">r1_sc</span> <span class="o">=</span> <span class="n">r1_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">r1_cdt</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">r1_sc</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">r2_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                            <span class="n">r2_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c1_input</span><span class="p">,</span> <span class="n">s1_input</span><span class="p">,</span> <span class="n">s2_input</span><span class="p">,</span> <span class="n">r1_input</span><span class="p">]</span>
                            <span class="n">r2_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_func</span><span class="p">(</span><span class="n">r2_inputs</span><span class="p">)</span>
                            <span class="n">r2_cdts</span> <span class="o">=</span> <span class="n">r2_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span>
                                <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="n">r2_rank_thres</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">r2_cdts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r2_input_user</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">r2_cdt</span> <span class="ow">in</span> <span class="n">r2_cdts</span><span class="p">:</span>
                            <span class="n">r2_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_dict</span><span class="p">[</span><span class="n">r2_cdt</span><span class="p">]</span>
                            <span class="n">r2_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_dim</span><span class="p">])</span>
                            <span class="n">r2_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">r2_cdt</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">r2_input_user</span> <span class="o">==</span> <span class="p">[]:</span>
                                <span class="n">r2_sc</span> <span class="o">=</span> <span class="n">r2_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">r2_cdt</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">r2_sc</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">T_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fp_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c1_input</span><span class="p">,</span> <span class="n">s1_input</span><span class="p">,</span> <span class="n">s2_input</span><span class="p">,</span> <span class="n">r1_input</span><span class="p">,</span> <span class="n">r2_input</span><span class="p">]</span>
                            <span class="n">T_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T_func</span><span class="p">(</span><span class="n">T_inputs</span><span class="p">)</span>
                            <span class="c1"># print(c1_name,s1_name,s2_name,r1_name,r2_name)</span>
                            <span class="n">cat_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1_name</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">r2_name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">rgt_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">r1_name</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span> <span class="n">rgt_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">r1_name</span><span class="p">,</span><span class="n">r2_name</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">s2_name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="n">slv_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1_name</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span> <span class="n">slv_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1_name</span><span class="p">,</span><span class="n">s2_name</span><span class="p">]</span>
                            <span class="c1"># if self.with_smiles:</span>
                            <span class="c1">#     rgt_name = [rgt for rgt in rgt_name if &#39;Reaxys&#39; not in rgt]</span>
                            <span class="c1">#     slv_name = [slv for slv in slv_name if &#39;Reaxys&#39; not in slv]</span>
                            <span class="c1">#     cat_name = [cat for cat in cat_name if &#39;Reaxys&#39; not in cat]</span>
                            <span class="c1">##for testing purpose only, output order as training</span>
                            <span class="k">if</span> <span class="n">return_categories_only</span><span class="p">:</span>
                                <span class="n">context_combos</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">c1_cdt</span><span class="p">,</span><span class="n">s1_cdt</span><span class="p">,</span><span class="n">s2_cdt</span><span class="p">,</span><span class="n">r1_cdt</span><span class="p">,</span><span class="n">r2_cdt</span><span class="p">,</span><span class="n">T_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                            <span class="c1">## esle ouptupt format compatible with the overall framework</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">context_combos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">T_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">slv_name</span><span class="p">),</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rgt_name</span><span class="p">),</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cat_name</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>

                            <span class="n">context_combo_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">c1_sc</span><span class="o">*</span><span class="n">s1_sc</span><span class="o">*</span><span class="n">s2_sc</span><span class="o">*</span><span class="n">r1_sc</span><span class="o">*</span><span class="n">r2_sc</span><span class="p">)</span>
        <span class="n">context_ranks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">num_combos</span><span class="o">+</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">context_combo_scores</span><span class="p">))</span>

        <span class="n">context_combos</span> <span class="o">=</span> <span class="p">[</span><span class="n">context_combos</span><span class="p">[</span>
            <span class="n">context_ranks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_combos</span><span class="p">)]</span>
        <span class="n">context_combo_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">context_combo_scores</span><span class="p">[</span>
            <span class="n">context_ranks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_combos</span><span class="p">)]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">context_combos</span><span class="p">,</span> <span class="n">context_combo_scores</span><span class="p">)</span></div>

<div class="viewcode-block" id="NeuralNetContextRecommender.category_to_name"><a class="viewcode-back" href="../../../../makeit.synthetic.context.html#makeit.synthetic.context.neuralnetwork.NeuralNetContextRecommender.category_to_name">[docs]</a>    <span class="k">def</span> <span class="nf">category_to_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chem_type</span><span class="p">,</span><span class="n">category</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns name ??</span>

<span class="sd">        Args:</span>
<span class="sd">            chem_type (str): ??</span>
<span class="sd">            category (??): ??</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chem_type</span> <span class="o">==</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">chem_type</span> <span class="o">==</span> <span class="s1">&#39;s1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">chem_type</span> <span class="o">==</span> <span class="s1">&#39;s2&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">chem_type</span> <span class="o">==</span> <span class="s1">&#39;r1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r1_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">chem_type</span> <span class="o">==</span> <span class="s1">&#39;r2&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="n">NeuralNetContextRecommender</span><span class="p">()</span>

    <span class="n">cont</span><span class="o">.</span><span class="n">load_nn_model</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="n">NEURALNET_CONTEXT_REC</span><span class="p">[</span><span class="s1">&#39;model_path&#39;</span><span class="p">],</span> <span class="n">info_path</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="n">NEURALNET_CONTEXT_REC</span><span class="p">[</span>
                       <span class="s1">&#39;info_path&#39;</span><span class="p">],</span> <span class="n">weights_path</span><span class="o">=</span><span class="n">gc</span><span class="o">.</span><span class="n">NEURALNET_CONTEXT_REC</span><span class="p">[</span><span class="s1">&#39;weights_path&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cont</span><span class="o">.</span><span class="n">get_n_conditions</span><span class="p">(</span><span class="s1">&#39;CC1(C)OBOC1(C)C.Cc1ccc(Br)cc1&gt;&gt;Cc1cccc(B2OC(C)(C)C(C)(C)O2)c1&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">with_smiles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_scores</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">ASKCOS</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../askcos.html">askcos package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../makeit.html">makeit package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rdchiral.html">rdchiral package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, ASKCOS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>